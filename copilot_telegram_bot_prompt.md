# Prompt для Copilot Agent: Telegram-бот на Python с офлайн-отладкой логики

Ты — агент разработки (Copilot Agent). Твоя задача: создать **Telegram-бота на Python**, реализующего логику меню/заявок/чата по приложенной Mermaid-схеме, **с возможностью полной офлайн-отладки без Telegram API**.

---

## 1. Цели и требования

- Реализовать пользовательский флоу:
  - start / любой текст → приветствие → меню
  - Консультация со специалистом (форма + заявка)
  - Консультация с ИИ (заглушка)
  - Условия обращения
  - Вопрос по психологии
- Поддержка команд:
  - `menu` — возврат в меню
  - `clear` — очистка контекста ИИ
- Логика должна быть полностью тестируема **без Telegram API**
- Агент обязан запускать тесты локально и исправлять ошибки

---

## 2. Технологии

- Python 3.11+
- pytest
- dataclasses или pydantic
- Telegram API не используется в debug-режиме

---

## 3. Архитектура (обязательно)

Проект по принципам Clean Architecture:

- domain/
- application/
- infrastructure/
- adapters/
  - cli/
  - telegram/ (заготовка)
- tests/

Бизнес-логика не должна зависеть от Telegram.

---

## 4. State Machine

Состояния:

- MENU
- CONSULT_FORM_TOPIC
- CONSULT_FORM_GENDER
- CONSULT_FORM_AGE
- CONSULT_FORM_SEVERITY
- CONSULT_FORM_MESSAGE
- AI_CHAT
- TERMS
- PSY_QUESTION

Правила:

- `menu` работает из любого состояния
- `clear` очищает контекст в AI_CHAT

---

## 5. CLI Debug Runner

Команда запуска:

```bash
python -m adapters.cli
```

Функции:
- ввод сообщений пользователем
- вывод ответов бота
- отображение текущего состояния
- reset сессии

---

## 6. Хранилище

Минимум:
- InMemory tickets
- InMemory sessions

Опционально:
- JSON или SQLite

---

## 7. Тесты

Обязательные сценарии:

- Happy path пользователя
- Возврат в меню
- AI chat + clear
- Админ-поток (взять в работу, сменить статус)

Тесты должны проходить офлайн.

---

## 8. Definition of Done

- pytest проходит локально
- CLI работает
- Telegram API не требуется
- Код структурирован
- README с инструкциями

---

## 9. Пошаговая инструкция агенту

1. Создай структуру проекта
2. Реализуй domain-модели
3. Реализуй state machine
4. Добавь in-memory реализации
5. Реализуй CLI
6. Напиши тесты
7. Запусти тесты и исправь ошибки
8. Подготовь точку расширения под Telegram

Важно: офлайн, детерминированно, с тестами.
