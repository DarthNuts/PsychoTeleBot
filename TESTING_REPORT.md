# –û—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ä–æ–ª–µ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

**–î–∞—Ç–∞:** 2026-01-31  
**–í–µ—Ä—Å–∏—è:** 2.0  
**–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:** 82 (50 –Ω–æ–≤—ã—Ö + 32 —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã

## –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### –§–∞–π–ª: `tests/test_roles.py`

**–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:** 50  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 0.11s  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ 50/50 PASSED

## –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ—Å—Ç–æ–≤

### 1. TestUserRole (3 —Ç–µ—Å—Ç–∞)
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ enum UserRole

**‚úÖ –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ:**
- `test_user_role_values` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π enum
- `test_user_role_comparison` - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–æ–ª–µ–π
- `test_user_role_string_conversion` - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Å—Ç—Ä–æ–∫—É

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è enum (USER, PSYCHOLOGIST, ADMIN)
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- String representation

---

### 2. TestUserProfile (4 —Ç–µ—Å—Ç–∞)
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ dataclass UserProfile

**‚úÖ –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ:**
- `test_create_basic_profile` - —Å–æ–∑–¥–∞–Ω–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
- `test_create_full_profile` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏
- `test_profile_defaults` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**‚úÖ –ì—Ä–∞–Ω–∏—á–Ω—ã–µ:**
- `test_profile_with_empty_strings` - –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ –ø–æ–ª—è—Ö

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- –°–æ–∑–¥–∞–Ω–∏–µ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ –≤—Å–µ–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- Default values (role=USER, created_at, updated_at)
- Edge case: –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏

---

### 3. TestRoleManager (35 —Ç–µ—Å—Ç–æ–≤)
–û—Å–Ω–æ–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞ RoleManager

#### 3.1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (2 —Ç–µ—Å—Ç–∞)

**‚úÖ –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ:**
- `test_create_empty_manager` - —Å–æ–∑–¥–∞–Ω–∏–µ –±–µ–∑ –∞–¥–º–∏–Ω–æ–≤
- `test_create_manager_with_admins` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å —Å–ø–∏—Å–∫–æ–º –∞–¥–º–∏–Ω–æ–≤

#### 3.2 –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (4 —Ç–µ—Å—Ç–∞)

**‚úÖ –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ:**
- `test_get_or_create_new_user` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `test_get_or_create_existing_user` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ù–ï –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è)
- `test_get_or_create_with_metadata` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å –ø–æ–ª–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- `test_get_or_create_admin_user` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏ ADMIN

#### 3.3 –ü–æ–≤—ã—à–µ–Ω–∏–µ –¥–æ –ø—Å–∏—Ö–æ–ª–æ–≥–∞ (4 —Ç–µ—Å—Ç–∞)

**‚úÖ –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ:**
- `test_promote_to_psychologist_success` - —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ

**‚ùå –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ:**
- `test_promote_nonexistent_user` - –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–≤—ã—Å–∏—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
- `test_promote_admin_to_psychologist` - –Ω–µ–ª—å–∑—è –ø–æ–Ω–∏–∑–∏—Ç—å –∞–¥–º–∏–Ω–∞

**‚ö†Ô∏è –ì—Ä–∞–Ω–∏—á–Ω—ã–µ:**
- `test_promote_already_psychologist` - –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ

#### 3.4 –ü–æ–Ω–∏–∂–µ–Ω–∏–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∞ (4 —Ç–µ—Å—Ç–∞)

**‚úÖ –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ:**
- `test_demote_psychologist_success` - —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–Ω–∏–∂–µ–Ω–∏–µ

**‚ùå –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ:**
- `test_demote_nonexistent_user` - –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–Ω–∏–∑–∏—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
- `test_demote_admin` - –Ω–µ–ª—å–∑—è –ø–æ–Ω–∏–∑–∏—Ç—å –∞–¥–º–∏–Ω–∞

**‚ö†Ô∏è –ì—Ä–∞–Ω–∏—á–Ω—ã–µ:**
- `test_demote_regular_user` - –ø–æ–Ω–∏–∂–µ–Ω–∏–µ –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### 3.5 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π is_psychologist (4 —Ç–µ—Å—Ç–∞)

**‚úÖ –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ:**
- `test_is_psychologist_true` - –ø—Å–∏—Ö–æ–ª–æ–≥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- `test_is_psychologist_false` - –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Å–∏—Ö–æ–ª–æ–≥

**‚ùå –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ:**
- `test_is_psychologist_nonexistent` - –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

**‚ö†Ô∏è –ì—Ä–∞–Ω–∏—á–Ω—ã–µ:**
- `test_is_psychologist_admin` - –∞–¥–º–∏–Ω –ù–ï —è–≤–ª—è–µ—Ç—Å—è –ø—Å–∏—Ö–æ–ª–æ–≥–æ–º

#### 3.6 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π is_admin (4 —Ç–µ—Å—Ç–∞)

**‚úÖ –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ:**
- `test_is_admin_true` - –∞–¥–º–∏–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- `test_is_admin_false` - –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–¥–º–∏–Ω

**‚ùå –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ:**
- `test_is_admin_nonexistent` - –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

**‚ö†Ô∏è –ì—Ä–∞–Ω–∏—á–Ω—ã–µ:**
- `test_is_admin_without_profile` - –∞–¥–º–∏–Ω –±–µ–∑ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ admin_ids –Ω–∞–ø—Ä—è–º—É—é)

#### 3.7 –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–æ–ª–∏ (4 —Ç–µ—Å—Ç–∞)

**‚úÖ –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ:**
- `test_get_role_user` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–æ–ª–∏ USER
- `test_get_role_psychologist` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–æ–ª–∏ PSYCHOLOGIST
- `test_get_role_admin` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–æ–ª–∏ ADMIN

**‚ùå –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ:**
- `test_get_role_nonexistent` - —Ä–æ–ª—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç USER)

#### 3.8 –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (2 —Ç–µ—Å—Ç–∞)

**‚úÖ –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ:**
- `test_get_user_exists` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è

**‚ùå –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ:**
- `test_get_user_not_exists` - –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç None)

#### 3.9 –°–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (6 —Ç–µ—Å—Ç–æ–≤)

**‚úÖ –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ:**
- `test_list_psychologists_empty` - –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤
- `test_list_psychologists_multiple` - –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤
- `test_list_admins_empty` - –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤
- `test_list_admins_multiple` - –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–æ–≤

**‚ö†Ô∏è –ì—Ä–∞–Ω–∏—á–Ω—ã–µ:**
- `test_list_psychologists_excludes_admins` - –∞–¥–º–∏–Ω—ã –ù–ï –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤ —Å–ø–∏—Å–æ–∫ –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤
- `test_list_admins_only_created` - —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –≤ —Å–ø–∏—Å–∫–µ

#### 3.10 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (2 —Ç–µ—Å—Ç–∞)

**‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
- `test_multiple_operations_sequence` - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π (—Å–æ–∑–¥–∞–Ω–∏–µ, –ø–æ–≤—ã—à–µ–Ω–∏–µ, –ø–æ–Ω–∏–∂–µ–Ω–∏–µ, –ø—Ä–æ–≤–µ—Ä–∫–∞)
- `test_role_persistence_simulation` - —Å–∏–º—É–ª—è—Ü–∏—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞)

---

### 4. TestRoleManagerEdgeCases (8 —Ç–µ—Å—Ç–æ–≤)
–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ –∏ –æ—Å–æ–±—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

**‚ö†Ô∏è –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏:**
- `test_empty_user_id` - –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –∫–∞–∫ user_id
- `test_very_long_user_id` - –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–π ID (1000 —Å–∏–º–≤–æ–ª–æ–≤)
- `test_special_characters_in_id` - —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –≤ ID
- `test_unicode_in_metadata` - Unicode –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞, –∫–∏—Ç–∞–π—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã)
- `test_none_values_in_admin_ids` - None –≤ —Å–ø–∏—Å–∫–µ –∞–¥–º–∏–Ω–æ–≤
- `test_duplicate_admin_ids` - –¥—É–±–ª–∏–∫–∞—Ç—ã –≤ admin_ids
- `test_role_change_updates_profile` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç updated_at

---

## –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏

### üêõ –ë–∞–≥ #1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –∞–¥–º–∏–Ω–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –í `__init__` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –ø—Ä–æ—Ñ–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö admin_ids  
**–¢–µ—Å—Ç:** `test_list_admins_only_created`  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –£–±—Ä–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –ø—Ä–æ—Ñ–∏–ª–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏

### üêõ –ë–∞–≥ #2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
**–ü—Ä–æ–±–ª–µ–º–∞:** `get_or_create_user` –æ–±–Ω–æ–≤–ª—è–ª username/first_name/last_name –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ  
**–¢–µ—Å—Ç:** `test_get_or_create_existing_user`  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### üêõ –ë–∞–≥ #3: is_psychologist –≤–æ–∑–≤—Ä–∞—â–∞–ª true –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–ª `role in (PSYCHOLOGIST, ADMIN)`  
**–¢–µ—Å—Ç:** `test_is_psychologist_admin`  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ `role == PSYCHOLOGIST`

### üêõ –ë–∞–≥ #4: list_psychologists –≤–∫–ª—é—á–∞–ª –∞–¥–º–∏–Ω–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ø–∏—Å–æ–∫ –≤–∫–ª—é—á–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é ADMIN  
**–¢–µ—Å—Ç:** `test_list_psychologists_excludes_admins`  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –§–∏–ª—å—Ç—Ä –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ `role == PSYCHOLOGIST`

### üêõ –ë–∞–≥ #5: is_admin –Ω–µ —Ä–∞–±–æ—Ç–∞–ª –±–µ–∑ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–ª —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ñ–∏–ª—å –≤ users  
**–¢–µ—Å—Ç:** `test_is_admin_without_profile`  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ admin_ids –Ω–∞–ø—Ä—è–º—É—é

### üêõ –ë–∞–≥ #6: String conversion enum
**–ü—Ä–æ–±–ª–µ–º–∞:** –û–∂–∏–¥–∞–ª–æ—Å—å –∑–Ω–∞—á–µ–Ω–∏–µ "user", –Ω–æ –ø–æ–ª—É—á–∞–ª–∏ "UserRole.USER"  
**–¢–µ—Å—Ç:** `test_user_role_string_conversion`  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –¢–µ—Å—Ç –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É .value –≤–º–µ—Å—Ç–æ str()

---

## –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

### UserRole enum
- ‚úÖ –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è (USER, PSYCHOLOGIST, ADMIN)
- ‚úÖ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ
- ‚úÖ String representation

### UserProfile dataclass
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ –≤—Å–µ–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- ‚úÖ Default values
- ‚úÖ Edge cases (–ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏)

### RoleManager –∫–ª–∞—Å—Å

**–ú–µ—Ç–æ–¥—ã:**
- ‚úÖ `__init__` - 2 —Ç–µ—Å—Ç–∞
- ‚úÖ `get_or_create_user` - 4 —Ç–µ—Å—Ç–∞
- ‚úÖ `get_user` - 2 —Ç–µ—Å—Ç–∞
- ‚úÖ `get_role` - 4 —Ç–µ—Å—Ç–∞
- ‚úÖ `promote_to_psychologist` - 4 —Ç–µ—Å—Ç–∞
- ‚úÖ `demote_psychologist` - 4 —Ç–µ—Å—Ç–∞
- ‚úÖ `is_psychologist` - 4 —Ç–µ—Å—Ç–∞
- ‚úÖ `is_admin` - 4 —Ç–µ—Å—Ç–∞
- ‚úÖ `list_psychologists` - 3 —Ç–µ—Å—Ç–∞
- ‚úÖ `list_admins` - 3 —Ç–µ—Å—Ç–∞

**–°—Ü–µ–Ω–∞—Ä–∏–∏:**
- ‚úÖ –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ (happy path)
- ‚úÖ –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ (–æ—à–∏–±–∫–∏, –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
- ‚úÖ –ì—Ä–∞–Ω–∏—á–Ω—ã–µ (edge cases, –æ—Å–æ–±—ã–µ —É—Å–ª–æ–≤–∏—è)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ (–∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏)

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –ø–æ —Ç–∏–ø–∞–º

| –¢–∏–ø —Ç–µ—Å—Ç–∞ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ü—Ä–æ—Ü–µ–Ω—Ç |
|-----------|------------|---------|
| –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ | 28 | 56% |
| –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ | 8 | 16% |
| –ì—Ä–∞–Ω–∏—á–Ω—ã–µ | 12 | 24% |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ | 2 | 4% |
| **–í–°–ï–ì–û** | **50** | **100%** |

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–ª–∞—Å—Å–∞–º

| –ö–ª–∞—Å—Å | –¢–µ—Å—Ç—ã | –ü–æ–∫—Ä—ã—Ç–∏–µ |
|-------|-------|----------|
| UserRole | 3 | 100% |
| UserProfile | 4 | 100% |
| RoleManager | 35 | 100% |
| Edge Cases | 8 | - |
| **–í–°–ï–ì–û** | **50** | **100%** |

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (–¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π)
```
6 failed, 44 passed in 0.36s
```

**–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå test_user_role_string_conversion
- ‚ùå test_get_or_create_existing_user
- ‚ùå test_is_psychologist_admin
- ‚ùå test_list_psychologists_excludes_admins
- ‚ùå test_list_admins_only_created
- ‚ùå test_multiple_operations_sequence

### –§–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π)
```
‚úÖ 50 passed in 0.11s
```

### –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞
```
‚úÖ 82 passed in 0.16s
```

- 32 —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–∞ (models, state_machine, bot_service)
- 50 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ (roles)
- –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

---

## –ö–∞—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤

### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

1. **–ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:** –í—Å–µ –º–µ—Ç–æ–¥—ã RoleManager –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
2. **–†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ:** –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ, –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ, –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
3. **–ò–∑–æ–ª—è—Ü–∏—è:** –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** Docstrings –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
5. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ:** –ù–∞—à–ª–∏ 6 —Ä–µ–∞–ª—å–Ω—ã—Ö –±–∞–≥–æ–≤
6. **–ë—ã—Å—Ç—Ä–æ—Ç–∞:** 50 —Ç–µ—Å—Ç–æ–≤ –∑–∞ 0.11s

### üìù –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ –æ—Ç–∑—ã–≤ —Ä–æ–ª–µ–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ä–æ–ª—è–º
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω–æ–≤

**–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏:**
- ‚úÖ –ü—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ –û—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
- ‚úÖ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
- ‚úÖ Unicode
- ‚úÖ None values
- ‚úÖ –î—É–±–ª–∏–∫–∞—Ç—ã

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- ‚úÖ –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –°–∏–º—É–ª—è—Ü–∏—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –º–µ—Ç–æ–¥–æ–≤

---

## –í—ã–≤–æ–¥—ã

### ‚úÖ –£—Å–ø–µ—à–Ω–æ

1. **–°–æ–∑–¥–∞–Ω—ã –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã:** 50 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Ä–æ–ª–µ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
2. **–ù–∞–π–¥–µ–Ω—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –±–∞–≥–∏:** 6 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º
3. **100% –ø–æ–∫—Ä—ã—Ç–∏–µ:** –í—Å–µ –º–µ—Ç–æ–¥—ã RoleManager –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
4. **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:** –í—Å–µ 82 —Ç–µ—Å—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç
5. **TDD –ø–æ–¥—Ö–æ–¥:** –¢–µ—Å—Ç—ã –ø–æ–º–æ–≥–ª–∏ —É–ª—É—á—à–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é

### üìä –ú–µ—Ç—Ä–∏–∫–∏

- **–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ—Å—Ç–æ–≤:** ~15 –º–∏–Ω—É—Ç
- **–ù–∞–π–¥–µ–Ω–æ –±–∞–≥–æ–≤:** 6
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –±–∞–≥–æ–≤:** 6
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 0.11s (50 —Ç–µ—Å—Ç–æ–≤)
- **Success rate:** 100%

### üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞:** –û–±–Ω–æ–≤–ª—è—Ç—å —Ç–µ—Å—Ç—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
2. **CI/CD:** –ó–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ
3. **–ü–æ–∫—Ä—ã—Ç–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è SQLite —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –°–ª–µ–¥–∏—Ç—å —á—Ç–æ–±—ã –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Å—Ç–∞–≤–∞–ª–æ—Å—å <1s

---

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

```bash
# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã —Ä–æ–ª–µ–π
pytest tests/test_roles.py -v

# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest tests/ -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest tests/test_roles.py --cov=domain.roles --cov-report=html

# –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫
pytest tests/test_roles.py -q
```

---

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:** –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞. –í—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –±–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. ‚úÖ
